<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running autofonce &mdash; autofonce master
 (f348e80
) (2023/02/08 15:18) documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/fixes.css" type="text/css" />
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sub-commands and Arguments" href="commands.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> autofonce
          </a>
              <div class="version">
                master
 (f348e80
)
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://ocamlpro.github.io/autofonce">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running <code class="code docutils literal notranslate"><span class="pre">autofonce</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#project-initialization">Project Initialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#listing-all-tests">Listing all tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-all-tests">Running all tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#selecting-tests">Selecting Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#promoting-tests">Promoting tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-multiple-testsuites">Working with multiple testsuites</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Sub-commands and Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="project.html">Project Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="compat.html">Compatibility with Autoconf</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">Copyright and License</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/ocamlpro/autofonce">Devel and Issues on Github</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">autofonce</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Running <code class="code docutils literal notranslate"><span class="pre">autofonce</span></code></li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="running-autofonce">
<h1>Running <code class="code docutils literal notranslate"><span class="pre">autofonce</span></code><a class="headerlink" href="#running-autofonce" title="Permalink to this headline"></a></h1>
<section id="project-initialization">
<h2>Project Initialization<a class="headerlink" href="#project-initialization" title="Permalink to this headline"></a></h2>
<p>Before running tests, you will need to configure the project to run
<code class="code docutils literal notranslate"><span class="pre">autofonce</span></code>. Some projects may come (in the future) with a
predefined configuration, with the presence of a <code class="code docutils literal notranslate"><span class="pre">.autofonce</span></code>
file. Otherwise, you will need to create a file <code class="code docutils literal notranslate"><span class="pre">autofonce.toml</span></code>.</p>
<p>If you need to create this <code class="code docutils literal notranslate"><span class="pre">autofonce.toml</span></code>, you can use:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">$</span> <span class="n">autofonce</span> <span class="n">init</span>
</pre></div>
</div>
<p>Using this command makes <code class="code docutils literal notranslate"><span class="pre">autofonce</span></code> try to autodetect the
project, in which case it can generate a good example. Autodetection
will only work for <em>known</em> projects, currently only
<code class="code docutils literal notranslate"><span class="pre">gnucobol</span></code>. For autodetection to work, the name of a directory
in the path should match the name of the known project.</p>
<p>Once this file has been generated, you should check its content to
verify that it matches your own setting. See the
<a class="reference internal" href="project.html#project-configuration"><span class="std std-ref">Project Configuration</span></a> section for more information.</p>
<p>In the presence of a <code class="code docutils literal notranslate"><span class="pre">autofonce.toml</span></code> file, <code class="code docutils literal notranslate"><span class="pre">autofonce</span></code>
will run the tests from the directory containing this file, within a
sub-directory <code class="code docutils literal notranslate"><span class="pre">_autofonce/</span></code>.</p>
<p>If <code class="code docutils literal notranslate"><span class="pre">autofonce.toml</span></code> is absent and the <code class="code docutils literal notranslate"><span class="pre">.autofonce</span></code> project
file is used, then <code class="code docutils literal notranslate"><span class="pre">autofonce</span></code> will use the build directory
detected by the <code class="code docutils literal notranslate"><span class="pre">build_anchors</span></code> as the directory where to create
the <code class="code docutils literal notranslate"><span class="pre">_autofonce/</span></code> directory.</p>
</section>
<section id="listing-all-tests">
<h2>Listing all tests<a class="headerlink" href="#listing-all-tests" title="Permalink to this headline"></a></h2>
<p>Once you have a working project configuration, you can try to read the
testsuite using:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">$</span> <span class="n">autofonce</span> <span class="kt">list</span>
</pre></div>
</div>
<p>This command should display the list of tests it was able to read, or
errors if it could not read the testsuite.</p>
</section>
<section id="running-all-tests">
<h2>Running all tests<a class="headerlink" href="#running-all-tests" title="Permalink to this headline"></a></h2>
<p>Once you are able to read the testsuite, you can run the tests with:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">$</span> <span class="n">autofonce</span> <span class="n">run</span>
</pre></div>
</div>
<p>If a failure appends, you can check the directory
<code class="code docutils literal notranslate"><span class="pre">_autofonce/NNNN/</span></code> where <code class="code docutils literal notranslate"><span class="pre">NNNN</span></code> is the test numeric
identifier.</p>
<p>For skipped test, you can check the file <code class="code docutils literal notranslate"><span class="pre">_autofonce/results.log</span></code>.</p>
<p>Unless you use the arguments <code class="code docutils literal notranslate"><span class="pre">--keep-more</span></code> or <code class="code docutils literal notranslate"><span class="pre">--keep-all</span></code>,
test sub-directories are not kept if the tests are skipped, or if they
succeed.</p>
<p>Within a test sub-directory, you should find:</p>
<ul>
<li><p><code class="code docutils literal notranslate"><span class="pre">env_autofonce.sh</span></code>: the script used to initialize the environment
for the test. It contains the content of the file <code class="code docutils literal notranslate"><span class="pre">autofonce.env</span></code>.
If you want to call commands in this directory with the same env as the
tests, you should use:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">.</span> <span class="o">./</span><span class="n">env_autofonce</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p><code class="code docutils literal notranslate"><span class="pre">00_CHECK.sh</span></code>: the shell script to run the first check of the test</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">00_CHECK.out</span></code>: the stdout output of the test</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">00_CHECK.err</span></code>: the stderr output of the test</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">00_CHECK.???.expected</span></code>: if the comparison between the outputs
failed, this file contains what was expected by the test</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">CHECK</span></code> files are numbered, with nested numbering for nested checks</p></li>
<li><p>other files are either files created by <code class="code docutils literal notranslate"><span class="pre">AT_DATA</span></code> macros, or files
generated by checks</p></li>
</ul>
</section>
<section id="selecting-tests">
<h2>Selecting Tests<a class="headerlink" href="#selecting-tests" title="Permalink to this headline"></a></h2>
<p>When you are working on tests, you sometimes want to select only a few
of them, instead of running the whole testsuite that will take a lot
of time.</p>
<p>You can use the following options to select tests, or a combination of
them:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">--before</span> <span class="pre">N</span></code>: run selected tests before <code class="code docutils literal notranslate"><span class="pre">N</span></code> included</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--after</span> <span class="pre">N</span></code>: run selected tests after <code class="code docutils literal notranslate"><span class="pre">N</span></code> included</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--ids</span> <span class="pre">'N1</span> <span class="pre">N2</span> <span class="pre">N3'</span></code>: run tests <code class="code docutils literal notranslate"><span class="pre">N1</span></code>, <code class="code docutils literal notranslate"><span class="pre">N2</span></code> and <code class="code docutils literal notranslate"><span class="pre">N3</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">-k</span> <span class="pre">KEYWORD</span></code>: run tests matching <code class="code docutils literal notranslate"><span class="pre">KEYWORD</span></code>, as specified by
the <code class="code docutils literal notranslate"><span class="pre">AT_KEYWORD(...)</span></code> macro</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--not</span> <span class="pre">'K1</span> <span class="pre">K2'</span></code>: do not run selected tests that match keywords
<code class="code docutils literal notranslate"><span class="pre">K1</span></code> or <code class="code docutils literal notranslate"><span class="pre">K2</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--failed</span></code>: run only selected tests that failed during previous run</p></li>
</ul>
</section>
<section id="promoting-tests">
<h2>Promoting tests<a class="headerlink" href="#promoting-tests" title="Permalink to this headline"></a></h2>
<p>Sometimes, you change the behavior of your tool, and some tests need
to be updated to match the new behavior. Such a work can be
cumbersome, especially when the expected stdout/stderr of the tests
are specified.</p>
<p><code class="code docutils literal notranslate"><span class="pre">autofonce</span></code> can help you be promoting the outputs of failed
tests directly inside the corresponding tests files.</p>
<p>Here is the processus:</p>
<ul>
<li><p>Run the tests:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">autofonce</span> <span class="n">run</span>
</pre></div>
</div>
</li>
<li><p>Check all the failed tests and verify that their reasons for failing is
ok. A way to do that is to use this command:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">autofonce</span> <span class="n">promote</span>
</pre></div>
</div>
<p>The command will display a diff of what it would do to <em>patch</em> the
tests, i.e. show the difference between the output and what was
expected.</p>
</li>
<li><p>Once you think the new output of the tests is ok, you can ask
<code class="code docutils literal notranslate"><span class="pre">autofonce</span></code> to update the files:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">autofonce</span> <span class="n">promote</span> <span class="o">--</span><span class="n">apply</span>
</pre></div>
</div>
</li>
<li><p>It is still a good idea to check the results, for example using
<code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code> or a similar tool.</p></li>
</ul>
<p>Note that <code class="code docutils literal notranslate"><span class="pre">autofonce</span></code> will add a comment <code class="code docutils literal notranslate"><span class="pre">#</span> <span class="pre">promoted</span> <span class="pre">on</span>
<span class="pre">&lt;DATE&gt;</span></code> to every updated test. You may remove this comment using the
option <code class="code docutils literal notranslate"><span class="pre">--no-comment</span></code>.</p>
</section>
<section id="working-with-multiple-testsuites">
<h2>Working with multiple testsuites<a class="headerlink" href="#working-with-multiple-testsuites" title="Permalink to this headline"></a></h2>
<p>If your project contains several testsuites, or if you want to be able
to run the same testsuites with different settings (for example,
before installation and after installation), you may define several
such testsuites in <code class="code docutils literal notranslate"><span class="pre">autofonce.toml</span></code> or <code class="code docutils literal notranslate"><span class="pre">.autofonce</span></code>.</p>
<p>You can then use the <code class="code docutils literal notranslate"><span class="pre">-t</span> <span class="pre">TESTSUITE</span></code> option to run a different
testsuite than the default one (i.e. the first defined one):</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">autofonce</span> <span class="n">run</span> <span class="o">-</span><span class="n">t</span> <span class="n">installed</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="project.html#testsuite-descriptions"><span class="std std-ref">Testsuite Descriptions</span></a> for more information.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="commands.html" class="btn btn-neutral float-right" title="Sub-commands and Arguments" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright OCamlPro SAS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>